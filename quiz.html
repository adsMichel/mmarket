<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíñ Quiz de Relacionamento Essencial - M√∫ltiplos Usu√°rios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Cores personalizadas para o tema "feminino" */
        .bg-rose-light { background-color: #FCE7F6; }
        .text-fuchsia-dark { color: #A21CAF; }
        .border-pink-medium { border-color: #DB2777; }
        .bg-pink-medium { background-color: #DB2777; }
        /* Para preservar a quebra de linha nas respostas */
        .whitespace-pre-wrap {
            white-space: pre-wrap;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'rose-light': '#FCE7F6',
                        'fuchsia-dark': '#A21CAF',
                        'pink-medium': '#DB2777',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-rose-light min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-3xl bg-white shadow-2xl rounded-xl p-8 md:p-12">
        <h1 class="text-3xl font-extrabold text-fuchsia-dark mb-6 text-center">
            üíñ Quiz do Casal: Perguntas Essenciais
        </h1>

        <div id="quiz-container">
            </div>
        
        <div id="navigation-buttons" class="mt-8 flex justify-between" style="display: none;">
            <button id="prev-btn" class="bg-gray-400 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-500 transition duration-300 shadow-md disabled:opacity-50" disabled>
                Anterior
            </button>
            <button id="next-btn" class="bg-pink-medium text-white font-semibold py-2 px-4 rounded-lg hover:bg-fuchsia-dark transition duration-300 shadow-xl">
                Pr√≥xima Pergunta
            </button>
        </div>
    </div>

    <script>
        // Chave de armazenamento principal para guardar todos os quizzes por nome
        const STORAGE_KEY = 'relationshipQuizUsers'; 
        const TEMPORARY_ANSWERS_KEY = 'tempQuizAnswers'; // Chave para respostas em andamento
        const questionsData = [
            // ... (Seu array de perguntas permanece o mesmo)
            { "id": 1, "question": "Voc√™ quer ter filhos?", "notes": "Provavelmente a pergunta mais √≥bvia e b√°sica para fazer ao seu parceiro." },
            { "id": 2, "question": "Quantos filhos voc√™ quer ter?", "notes": "A pergunta seguinte obrigat√≥ria." },
            { "id": 3, "question": "O que voc√™ acha da minha fam√≠lia?", "notes": "Um bom relacionamento com os sogros tamb√©m √© vital." },
            { "id": 4, "question": "Com que frequ√™ncia n√≥s vamos visitar nossas fam√≠lias?", "notes": "Outro ponto a se considerar, e voc√™s devem avaliar v√°rios fatores." },
            { "id": 5, "question": "Onde n√≥s vamos morar?", "notes": "A sua vida seria muito melhor se voc√™ j√° soubesse isso antes do casamento." },
            { "id": 6, "question": "Do que voc√™ mais gosta no sexo?", "notes": "Sexo √© essencial no casamento." },
            { "id": 7, "question": "Quais s√£o os seus limites sexuais?", "notes": "Voc√™ j√° deve saber a essa altura, mas √© bom se certificar." },
            { "id": 8, "question": "O que mais te excita em mim?", "notes": "Esta ser√° uma conversa divertida!" },
            { "id": 9, "question": "Como voc√™ costuma expressar raiva?", "notes": "Isso √© muito importante para voc√™ saber o que esperar." },
            { "id": 10, "question": "Existe alguma coisa em mim que te irrita?", "notes": "√â importante porque voc√™s v√£o ficar juntos por um longo tempo." },
            { "id": 11, "question": "O que voc√™ acha que faz ou desfaz um relacionamento?", "notes": "Uma bem profunda que far√° o seu parceiro pensar." },
            { "id": 12, "question": "Quais s√£o as tr√™s coisas que voc√™ mais aprecia em mim?", "notes": "Lembrem um ao outro das coisas bonitas que voc√™s veem um no outro." },
            { "id": 13, "question": "O que te atraiu em mim?", "notes": "A primeira coisa bonita que seu parceiro viu em voc√™ √© uma lembran√ßa t√£o preciosa que ambos devem valorizar." },
            { "id": 14, "question": "O que lealdade e fidelidade significam para voc√™ no nosso casamento?", "notes": "Isso √© de extrema import√¢ncia." },
            { "id": 15, "question": "Como voc√™ nos v√™ daqui a dez anos?", "notes": "Voc√™ tem que ter aspira√ß√µes e sonhos para voc√™s dois." },
            { "id": 16, "question": "Qual foi o nosso momento juntos mais inesquec√≠vel para voc√™?", "notes": "Pense nos bons tempos." },
            { "id": 17, "question": "De quais nomes de beb√™ voc√™ gosta?", "notes": "Deixe seu parceiro escolher um nome de menina e um nome de menino, ent√£o decidam juntos." },
            { "id": 18, "question": "Quando foi a √∫ltima vez que voc√™ se sentiu mais amado por mim?", "notes": "Tome nota disso e fa√ßa mais!" },
            { "id": 19, "question": "O que te deixa com ci√∫mes?", "notes": "Esse diabo verde pode realmente arruinar relacionamentos, ent√£o √© melhor evit√°-lo." },
            { "id": 20, "question": "Quanto dinheiro voc√™ ganha?", "notes": "A transpar√™ncia quando se trata de finan√ßas deve ser estabelecida entre voc√™s dois." },
            { "id": 21, "question": "Voc√™ tem alguma d√≠vida grande?", "notes": "O que √© meu √© seu‚Ä¶ incluindo d√≠vidas, aparentemente." },
            { "id": 22, "question": "Voc√™ √© um poupador ou um gastador?", "notes": "Pergunte isso para que voc√™s possam ajudar um ao outro a controlar seu or√ßamento." },
            { "id": 23, "question": "Vamos ter um acordo pr√©-nupcial antes de nos casarmos?", "notes": "Uma das decis√µes mais pol√™micas entre noivos!" },
            { "id": 24, "question": "Precisamos abrir uma conta conjunta no banco?", "notes": "Vai ser uma propriedade conjugal, ent√£o voc√™s dois t√™m realmente que conversar sobre isso." },
            { "id": 25, "question": "O que √© mais importante, uma casa grande ou uma casa bem localizada?", "notes": "O seu endere√ßo residencial √© essencial para o seu futuro." },
            { "id": 26, "question": "De quanto devem ser nossas despesas mensais?", "notes": "Isso vai fazer ou quebrar seu or√ßamento." },
            { "id": 27, "question": "Onde nossos filhos v√£o estudar?", "notes": "Escola p√∫blica ou particular?" },
            { "id": 28, "question": "Voc√™ concorda com mentiras leves apenas para evitar discuss√µes?", "notes": "Acredite, algumas pessoas preferem olhar para o outro lado para salvar seu relacionamento." },
            { "id": 29, "question": "Eu j√° te decepcionei?", "notes": "Decep√ß√µes s√£o comuns, ent√£o n√£o se preocupe." },
            { "id": 30, "question": "Voc√™ me acha bonito(a)?", "notes": "A resposta deve ser um SIM!" },
            { "id": 31, "question": "Tudo bem se eu largar meu emprego quando j√° tivermos dois (2) filhos?", "notes": "As mulheres que trabalham costumam perguntar isso aos seus parceiros." },
            { "id": 32, "question": "Quais s√£o seus objetivos de carreira?", "notes": "√â importante que voc√™s se apoiem em seus sonhos." },
            { "id": 33, "question": "Tudo bem se eu fizer hora extra e chegar tarde em casa?", "notes": "Voc√™ n√£o √© mais dono do seu pr√≥prio tempo quando est√° casado." },
            { "id": 34, "question": "Voc√™ est√° disposto a se mudar para outro pa√≠s se meu trabalho exigir?", "notes": "Esta √© definitivamente uma decis√£o muito dif√≠cil para voc√™s dois." },
            { "id": 35, "question": "Qual √© a sua viagem dos sonhos?", "notes": "Voc√™s podem, ent√£o, economizar para pagar essa viagem." },
            { "id": 36, "question": "O que voc√™ acha dos meus melhores amigos?", "notes": "Voc√™ precisa se dar bem com os amigos dele(a)." },
            { "id": 37, "question": "Tudo bem se eu sair com meus amigos de vez em quando?", "notes": "Se o seu parceiro for uma pessoa festeira, voc√™s podem sair todos juntos!" },
            { "id": 38, "question": "Vamos ter uma faxineira?", "notes": "Se voc√™s dois estiverem trabalhando, sugiro que o fa√ßam!" },
            { "id": 39, "question": "Tudo bem se eu fumar e/ou beber?", "notes": "Os v√≠cios do seu parceiro afetam n√£o apenas ele, mas tamb√©m voc√™." },
            { "id": 40, "question": "Qu√£o importante √© a sua f√© e religi√£o para voc√™?", "notes": "Pol√™mico, mas voc√™s t√™m que falar sobre isso." },
            { "id": 41, "question": "Voc√™ espera que eu participe das atividades da sua igreja?", "notes": "Voc√™ s√≥ precisa se comprometer nas suas expectativas." },
            { "id": 42, "question": "Voc√™ cozinha?", "notes": "Simples, mas afetar√° muitas das suas tradi√ß√µes, tarefas e despesas." },
            { "id": 43, "question": "Com que frequ√™ncia voc√™ acha que devemos jantar fora em uma semana?", "notes": "Voc√™s definitivamente precisam concordar!" },
            { "id": 44, "question": "Como vamos dividir as contas?", "notes": "Foi-se o tempo em que maridos/homens pagavam tudo." },
            { "id": 45, "question": "O que √© mais importante, trabalho ou fam√≠lia?", "notes": "√â aqui que entra o princ√≠pio do equil√≠brio entre vida profissional e pessoal." },
            { "id": 46, "question": "Que dist√¢ncia de idade voc√™ quer que nossos filhos tenham?", "notes": "O planejamento familiar realmente ajuda." },
            { "id": 47, "question": "Voc√™ consideraria o div√≥rcio?", "notes": "Vai ser dif√≠cil falar sobre isso, mas √© preciso." },
            { "id": 48, "question": "Voc√™ √© contra m√©todos contraceptivos?", "notes": "√â pr√°tico falar sobre esse tipo de coisa." },
            { "id": 49, "question": "Quem deve fazer as tarefas dom√©sticas?", "notes": "Voc√™s dois podem dividir dependendo de suas cargas de trabalho e das tarefas que sabem fazer." },
            { "id": 50, "question": "Qual voc√™ acha que √© o seu papel como marido/esposa?", "notes": "Isso deve ficar muito claro desde o in√≠cio. Esse papel √© para toda a vida." },
            { "id": 51, "question": "Qu√£o bem voc√™ faz or√ßamentos?", "notes": "Outra quest√£o sobre finan√ßas que √© essencial para ser abordada por todos os casais." },
            { "id": 52, "question": "E se quisermos algo que n√£o pudermos pagar?", "notes": "Disciplina e contentamento s√£o realmente a chave para evitar despesas desnecess√°rias." },
            { "id": 53, "question": "Precisamos poupar para a aposentadoria?", "notes": "A menos que voc√™ seja podre de rico, SIM!" },
            { "id": 54, "question": "Voc√™ gosta de viajar?", "notes": "Se os dois gostarem, voc√™s ter√£o uma bela aventura juntos por toda a vida!" },
            { "id": 55, "question": "Qu√£o importante √© passar tempo com seus amigos para voc√™?", "notes": "√â preciso saber equilibrar tudo." },
            { "id": 56, "question": "Como devemos decidir se tivermos ideias/decis√µes opostas?", "notes": "Compromisso √© fundamental." },
            { "id": 57, "question": "Qual √© a sua ideia de um dia perfeito?", "notes": "Voc√™s devem fazer de cada dia um dia perfeito um para o outro." },
            { "id": 58, "question": "Para onde voc√™ gostaria de viajar?", "notes": "Fa√ßam uma lista juntos!" },
            { "id": 59, "question": "Voc√™ tem hist√≥rico familiar de doen√ßas?", "notes": "Isso pode ajudar voc√™s a prevenir quaisquer doen√ßas que possam ter sido herdadas." },
            { "id": 60, "question": "Qual √© o seu maior medo em rela√ß√£o ao casamento?", "notes": "Juntos, voc√™s podem vencer esses medos." },
            { "id": 61, "question": "O que voc√™ faria se nos desapaixon√°ssemos?", "notes": "Se voc√™s realmente amarem um ao outro, podem fazer dar certo." },
            { "id": 62, "question": "O que voc√™ acha que devemos fazer para apimentar nosso relacionamento?", "notes": "As possibilidades s√£o infinitas‚Ä¶" },
            { "id": 63, "question": "O dia do casamento te empolga ou te aterroriza?", "notes": "Um pouco dos dois, certo?" },
            { "id": 64, "question": "Qual √© o nosso or√ßamento para o casamento?", "notes": "Concentre-se no or√ßamento, voc√™s n√£o precisam gastar muito." },
            { "id": 65, "question": "Quem n√≥s vamos convidar para o nosso casamento?", "notes": "Cerque-se de pessoas que te fazem feliz. Sua felicidade √© mais importante que a delas durante o casamento." },
            { "id": 66, "question": "Vamos ter um casamento grande ou √≠ntimo?", "notes": "Tudo depende de voc√™s!" },
            { "id": 67, "question": "Voc√™ gosta de animais de estima√ß√£o?", "notes": "Seria m√°gico se os dois gostassem!" },
            { "id": 68, "question": "Quantos animais de estima√ß√£o s√£o suficientes para voc√™?", "notes": "Concordem nessa, pois tamb√©m √© uma grande responsabilidade." },
            { "id": 69, "question": "Com que idade voc√™ quer se aposentar?", "notes": "Planejem seu futuro financeiro com um fundo de aposentadoria." },
            { "id": 70, "question": "Como voc√™ se sente ajudando a pagar uma d√≠vida do seu parceiro?", "notes": "De novo: ‚ÄúO que √© meu √© seu‚Äù." },
            { "id": 71, "question": "Com que frequ√™ncia voc√™ usa cart√µes de cr√©dito?", "notes": "Controlar o uso de cart√µes de cr√©dito ser√° ben√©fico para ambos." },
            { "id": 72, "question": "Voc√™ me acha sexualmente atraente?", "notes": "Entrar em detalhes √≠ntimos pode realmente melhorar seu relacionamento um com o outro." },
            { "id": 73, "question": "Voc√™ est√° pronto para sacrificar um pouco do seu espa√ßo pessoal?", "notes": "√â melhor estar, para sempre!" },
            { "id": 74, "question": "Voc√™ est√° pronto para morar comigo?", "notes": "Definitivamente sim!" },
            { "id": 75, "question": "Voc√™ est√° pronto para transar com apenas uma pessoa pelo resto da vida?", "notes": "O amor e o casamento podem te impelir a ser leal." },
            { "id": 76, "question": "Voc√™ espera alguma mudan√ßa no nosso relacionamento ap√≥s o casamento?", "notes": "Espero que n√£o, certo? No entanto, h√° a responsabilidade adicional." },
            { "id": 77, "question": "Quais s√£o seus feriados favoritos?", "notes": "Voc√™ pode ficar junto com o seu amor nos feriados. Eu amo todos eles." },
            { "id": 78, "question": "Como voc√™ comemorou seus anivers√°rios?", "notes": "Seu parceiro n√£o vai querer que voc√™ sinta muita falta de casa!" },
            { "id": 79, "question": "Voc√™ gosta de dar presentes caros?", "notes": "Disciplina e simplicidade s√£o a chave para uma vida feliz." },
            { "id": 80, "question": "Quais s√£o as tradi√ß√µes da sua fam√≠lia que voc√™ acha que ainda devemos seguir?", "notes": "Se voc√™ tiver um parceiro que valoriza tradi√ß√µes, tente respeit√°-lo." },
            { "id": 81, "question": "Em que situa√ß√µes voc√™ n√£o vai querer falar comigo?", "notes": "Evite fazer isso. A comunica√ß√£o tamb√©m √© fundamental." },
            { "id": 82, "question": "Voc√™ prefere um trabalho de hor√°rio flex√≠vel ou um trabalho de tempo integral?", "notes": "Voc√™s devem concordar com isso como casal." },
            { "id": 83, "question": "Qual √© a melhor maneira de provar a voc√™ que eu te amo?", "notes": "Brega, mas sempre funciona!" },
            { "id": 84, "question": "O que te repele do sexo?", "notes": "Voc√™ precisa saber disso para melhorar sua vida sexual!" },
            { "id": 85, "question": "Com o que voc√™ sonha com mais frequ√™ncia?", "notes": "Falar sobre sonhos com seu parceiro pode realmente aproxim√°-los um do outro." },
            { "id": 86, "question": "Se voc√™ pudesse planejar o encontro perfeito comigo, como seria?", "notes": "Tenham encontros nos dias anteriores ao casamento e permane√ßam consistentes quanto a isso." },
            { "id": 87, "question": "Por que casamento?", "notes": "Uma das mais dif√≠ceis de responder, mas voc√™ precisa saber." },
            { "id": 88, "question": "Como voc√™ lida com a mudan√ßa?", "notes": "O casamento √© uma grande mudan√ßa, ent√£o voc√™s dois devem estar prontos para isso." },
            { "id": 89, "question": "Qu√£o bem lidamos com as diverg√™ncias?", "notes": "Certifique-se de nunca dormir sem resolver um problema." },
            { "id": 90, "question": "Quanto valorizamos o tempo juntos e o tempo separados?", "notes": "Casar n√£o significa estar fisicamente juntos todos os dias. Tamb√©m √© saud√°vel estar separados √†s vezes." },
            { "id": 91, "question": "Quando voc√™ se sente inseguro ao compartilhar seus sentimentos comigo?", "notes": "√â o objetivo de todo casal ser o confidente um do outro." },
            { "id": 92, "question": "Qual √© a sua lembran√ßa de inf√¢ncia mais maravilhosa?", "notes": "Casar-se pode fazer voc√™ se sentir nost√°lgico √†s vezes." },
            { "id": 93, "question": "Voc√™ tem algum segredo importante que ainda n√£o compartilhou?", "notes": "Seria como ir √† confiss√£o do seu pr√≥prio casal ou a uma terapia antes de se casar!" },
            { "id": 94, "question": "Voc√™ est√° aberto a terapia se precisarmos?", "notes": "S√≥ para voc√™ poder riscar isso da lista." },
            { "id": 95, "question": "Voc√™ tem certeza de mim?", "notes": "Essa pode levar a declara√ß√µes bregas de amor de voc√™s dois." },
            { "id": 96, "question": "Voc√™ est√° com o p√© atr√°s?", "notes": "Outra maneira de perguntar se voc√™ tem certeza absoluta." },
            { "id": 97, "question": "Voc√™ pediria dinheiro emprestado a amigos ou familiares, se estivesse em extrema necessidade?", "notes": "Em √∫ltimo caso, espero." },
            { "id": 98, "question": "Voc√™ acredita que maridos e esposas devem ter partes iguais nas tarefas?", "notes": "O conhecimento das tarefas n√£o √© um papel de g√™nero." },
            { "id": 99, "question": "Quais s√£o seus objetivos financeiros?", "notes": "Voc√™s dois est√£o nisso juntos, ent√£o precisam discutir isso." },
            { "id": 100, "question": "Qual √© o seu maior medo?", "notes": "Refugiem-se no conhecimento de que voc√™s est√£o l√° um para o outro." },
            { "id": 101, "question": "Como posso te ajudar quando voc√™ estiver estressado?", "notes": "Uma pergunta linda e muito reconfortante que vai fazer voc√™ amar ainda mais o seu parceiro." }
        ];
        // ... (Seu array de perguntas permanece o mesmo)

        let currentQuestionIndex = 0;
        let currentUserName = null;
        const quizContainer = document.getElementById('quiz-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const navButtons = document.getElementById('navigation-buttons');

        // Carrega *todos* os quizzes salvos (por nome)
        function loadAllQuizzes() {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        }

        // Carrega respostas tempor√°rias (se houver um quiz em andamento)
        function loadTempAnswers() {
            return JSON.parse(sessionStorage.getItem(TEMPORARY_ANSWERS_KEY)) || {};
        }

        // Salva respostas temporariamente no sessionStorage
        function saveTempAnswers(answers) {
            sessionStorage.setItem(TEMPORARY_ANSWERS_KEY, JSON.stringify(answers));
        }

        // Armazena as respostas do quiz em andamento
        let answers = loadTempAnswers();

        function saveAnswer() {
            const answerTextarea = document.getElementById(`answer-${currentQuestionIndex}`);
            if (answerTextarea) {
                // Guarda a resposta atual
                answers[currentQuestionIndex] = answerTextarea.value;
                // Salva temporariamente no sessionStorage para manter o estado at√© o salvamento final
                saveTempAnswers(answers); 
            }
        }

        /* -------------------------------------------------------------------------- */
        /* NOVAS FUNCIONALIDADES                            */
        /* -------------------------------------------------------------------------- */

        function renderStartScreen() {
            navButtons.style.display = 'none';
            const allQuizzes = loadAllQuizzes();
            const userNames = Object.keys(allQuizzes);
            const savedQuizzesHtml = userNames.length > 0 ? `
                <h3 class="text-xl font-bold text-fuchsia-dark mt-8 mb-4 border-t pt-4">Resultados Salvos</h3>
                <ul class="space-y-2">
                    ${userNames.map(name => `
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg shadow-sm">
                            <span class="font-semibold text-gray-700">${name}</span>
                            <button onclick="viewUserSummary('${name}')" class="text-sm bg-pink-medium text-white py-1 px-3 rounded hover:bg-fuchsia-dark transition duration-200">
                                Ver Respostas
                            </button>
                        </li>
                    `).join('')}
                </ul>
            ` : '<p class="text-center text-gray-500 mt-6">Nenhum quiz conclu√≠do ainda.</p>';


            quizContainer.innerHTML = `
                <div class="text-center space-y-4">
                    <p class="text-lg text-gray-700 font-medium">Bem-vindo(a) ao Quiz do Casal!</p>
                    <p class="text-lg text-gray-700">Preencha seu nome para iniciar um novo quiz ou veja um resultado salvo:</p>
                </div>

                <div class="mt-6">
                    <label for="userName" class="block text-lg font-medium text-gray-700 mb-2">Seu Nome:</label>
                    <input type="text" id="userName" placeholder="Ex: Ana, Pedro, N√≥s" 
                        class="w-full p-3 border-2 border-pink-medium rounded-lg focus:ring-fuchsia-dark focus:border-fuchsia-dark transition duration-150"
                        value="${currentUserName || ''}" onkeydown="if(event.key === 'Enter') startQuiz()">
                </div>
                
                <div class="text-center mt-6">
                    <button onclick="startQuiz()" class="bg-fuchsia-dark text-white font-semibold py-3 px-6 rounded-lg hover:bg-pink-medium transition duration-300 shadow-xl disabled:opacity-50" id="start-btn">
                        Iniciar Novo Quiz
                    </button>
                </div>
                ${savedQuizzesHtml}
            `;

            // Garante que o bot√£o de in√≠cio seja atualizado se j√° houver texto
            const nameInput = document.getElementById('userName');
            const startBtn = document.getElementById('start-btn');
            nameInput.addEventListener('input', () => {
                startBtn.disabled = nameInput.value.trim() === '';
            });
            startBtn.disabled = nameInput.value.trim() === '';

             // Se houver respostas tempor√°rias, oferece a op√ß√£o de continuar
            if (Object.keys(answers).length > 0) {
                const continueBtnHtml = `
                    <div class="mt-6 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-lg">
                        <p class="font-bold">Quiz em Andamento!</p>
                        <p class="text-sm">Existem respostas n√£o finalizadas. Deseja <button onclick="continueQuiz()" class="text-blue-600 underline font-semibold">Continuar de onde parou</button> ou <button onclick="clearTempAndStartNew()" class="text-red-600 underline font-semibold">Come√ßar um novo</button>?</p>
                    </div>
                `;
                quizContainer.insertAdjacentHTML('afterbegin', continueBtnHtml);
            }
        }

        function clearTempAndStartNew() {
             sessionStorage.removeItem(TEMPORARY_ANSWERS_KEY);
             answers = {};
             renderStartScreen();
        }

        function startQuiz(userName) {
            const name = (userName || document.getElementById('userName').value).trim();
            if (!name) {
                alert("Por favor, digite um nome para come√ßar o quiz.");
                return;
            }
            
            currentUserName = name;
            navButtons.style.display = 'flex';
            
            // Carrega respostas tempor√°rias (se houver) ou come√ßa do zero
            answers = loadTempAnswers(); 

            if (Object.keys(answers).length > 0) {
                 // Se houver respostas, encontra o √∫ltimo √≠ndice para continuar
                const lastIndex = Math.max(...Object.keys(answers).map(Number));
                currentQuestionIndex = lastIndex < questionsData.length - 1 ? lastIndex + 1 : lastIndex;
            } else {
                currentQuestionIndex = 0;
            }
            
            renderQuestion(currentQuestionIndex);
        }

        function continueQuiz() {
             navButtons.style.display = 'flex';
             const lastIndex = Math.max(...Object.keys(answers).map(Number));
             currentQuestionIndex = lastIndex < questionsData.length - 1 ? lastIndex + 1 : lastIndex;
             renderQuestion(currentQuestionIndex);
        }

        function viewUserSummary(name) {
            const allQuizzes = loadAllQuizzes();
            const userAnswers = allQuizzes[name];
            if (!userAnswers) {
                alert(`As respostas para "${name}" n√£o foram encontradas.`);
                renderStartScreen();
                return;
            }

            renderSummary(userAnswers, name, true); // O terceiro par√¢metro indica que √© uma visualiza√ß√£o salva
        }
        
        function saveFinalQuiz(answersToSave, name) {
            const allQuizzes = loadAllQuizzes();
            allQuizzes[name] = answersToSave; // Salva as respostas sob o nome
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allQuizzes));
            sessionStorage.removeItem(TEMPORARY_ANSWERS_KEY); // Limpa as respostas tempor√°rias
            currentUserName = null; // Limpa o nome atual para o pr√≥ximo uso
            answers = {}; // Limpa o objeto de respostas em mem√≥ria
            alert(`Quiz de "${name}" salvo com sucesso!`);
        }

        /* -------------------------------------------------------------------------- */
        /* L√ìGICA EXISTENTE MODIFICADA                       */
        /* -------------------------------------------------------------------------- */
        
        function renderQuestion(index) {
            if (index < 0 || index >= questionsData.length) return;

            // Salva a resposta da pergunta anterior antes de mudar
            saveAnswer(); 

            const question = questionsData[index];
            
            // T√≠tulo para indicar quem est√° respondendo
            const userTitle = currentUserName ? `<p class="text-xl font-bold text-pink-medium mb-4 text-center">Respondendo como: ${currentUserName}</p>` : '';
            
            // HTML para a pergunta, dica e √°rea de resposta
            quizContainer.innerHTML = `
                ${userTitle}
                <div class="space-y-6">
                    <p class="text-lg font-medium text-gray-500 text-center">
                        Pergunta ${question.id} de ${questionsData.length}
                    </p>
                    <h2 class="text-2xl font-bold text-fuchsia-dark text-center">
                        ${question.question}
                    </h2>
                    
                    <div class="p-4 bg-rose-light border-l-4 border-pink-medium rounded-r-lg shadow-inner">
                        <p class="text-sm font-semibold text-pink-medium">Dica de Resposta:</p>
                        <p class="text-sm text-gray-700 mt-1">${question.notes}</p>
                    </div>

                    <div class="mt-6">
                        <label for="answer-${index}" class="block text-lg font-medium text-gray-700 mb-2">Sua Resposta:</label>
                        <textarea id="answer-${index}" rows="4" 
                            class="w-full p-3 border-2 border-pink-medium rounded-lg focus:ring-fuchsia-dark focus:border-fuchsia-dark transition duration-150" 
                            placeholder="Escreva sua resposta ou converse com seu parceiro...">${answers[index] || ''}</textarea>
                    </div>
                </div>
            `;
            
            // Adiciona listener de input para salvar a resposta enquanto o usu√°rio digita
            const answerTextarea = document.getElementById(`answer-${index}`);
            if (answerTextarea) {
                // Remove o listener anterior e adiciona o novo (por causa da troca de HTML)
                // Usamos o evento 'input' para salvar automaticamente
                answerTextarea.addEventListener('input', saveAnswer);
            }

            updateButtons();
        }

        function renderSummary(answersToDisplay = answers, name = currentUserName, isSavedView = false) {
            // Se for a conclus√£o do quiz (n√£o uma visualiza√ß√£o salva), salva a √∫ltima resposta
            if (!isSavedView) {
                saveAnswer(); 
            }
            navButtons.style.display = 'none';

            let summaryHtml = `
                <div class="text-center py-4 border-b border-gray-200">
                    <h2 class="text-3xl font-bold text-fuchsia-dark mb-2">${isSavedView ? 'Respostas Salvas de' : 'Quiz Conclu√≠do por'} üéâ</h2>
                    <h3 class="text-2xl font-bold text-pink-medium">${name}</h3>
                    <p class="text-lg text-gray-700 mt-2">${isSavedView ? 'Esta √© uma vers√£o salva.' : 'Suas respostas est√£o prontas para serem salvas.'}</p>
                </div>
                <div class="mt-6 space-y-8">
            `;

            questionsData.forEach((q, index) => {
                // Usa o objeto answersToDisplay (pode ser o tempor√°rio ou o salvo)
                const answer = answersToDisplay[index] || 'Nenhuma resposta registrada.';
                
                summaryHtml += `
                    <div class="p-5 border-2 border-gray-100 rounded-lg shadow-sm">
                        <p class="text-xl font-semibold text-pink-medium mb-2">
                            ${q.id}. ${q.question}
                        </p>
                        <div class="border-l-4 border-fuchsia-dark pl-4 py-1 bg-gray-50">
                            <p class="text-sm font-medium text-gray-800">Sua Resposta:</p>
                            <p class="text-base text-gray-600 whitespace-pre-wrap">${answer}</p>
                        </div>
                    </div>
                `;
            });

            summaryHtml += `
                </div>
                <div class="text-center mt-8 space-y-4">
            `;
            
            if (!isSavedView) {
                // Bot√£o para salvar o quiz apenas na conclus√£o
                summaryHtml += `
                    <button onclick="saveFinalQuiz(answers, currentUserName); renderStartScreen();" class="bg-pink-medium text-white font-semibold py-2 px-6 rounded-lg hover:bg-fuchsia-dark transition duration-300 shadow-md w-full md:w-auto">
                        Salvar Respostas e Voltar ao In√≠cio
                    </button>
                `;
            } else {
                 // Bot√£o de deletar quiz salvo (somente na visualiza√ß√£o salva)
                 summaryHtml += `
                    <button onclick="deleteUserQuiz('${name}'); renderStartScreen();" class="bg-red-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-red-600 transition duration-300 shadow-md w-full md:w-auto">
                        Deletar Quiz Salvo de ${name}
                    </button>
                 `;
            }
            
            // Bot√£o para voltar √† tela inicial
            summaryHtml += `
                    <button onclick="renderStartScreen()" class="bg-gray-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-gray-800 transition duration-300 shadow-md w-full md:w-auto">
                        Voltar √† Tela Inicial
                    </button>
                </div>
            `;

            quizContainer.innerHTML = summaryHtml;
        }

        // Nova fun√ß√£o para deletar um quiz salvo
        function deleteUserQuiz(name) {
            if (confirm(`Tem certeza que deseja deletar as respostas salvas para "${name}"?`)) {
                const allQuizzes = loadAllQuizzes();
                delete allQuizzes[name];
                localStorage.setItem(STORAGE_KEY, JSON.stringify(allQuizzes));
                alert(`Quiz de "${name}" deletado.`);
            }
        }
        
        function updateButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === questionsData.length - 1) {
                nextBtn.textContent = 'Finalizar e Salvar';
                nextBtn.classList.remove('bg-pink-medium', 'hover:bg-fuchsia-dark');
                nextBtn.classList.add('bg-fuchsia-dark', 'hover:bg-pink-medium');
            } else {
                nextBtn.textContent = 'Pr√≥xima Pergunta';
                nextBtn.classList.remove('bg-fuchsia-dark', 'hover:bg-pink-medium');
                nextBtn.classList.add('bg-pink-medium', 'hover:bg-fuchsia-dark');
            }
        }

        function handleNext() {
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            } else {
                // Ao finalizar, renderiza o sum√°rio para salvar
                if (!currentUserName) {
                     alert("Erro: Nome do usu√°rio n√£o definido. Retornando ao in√≠cio.");
                     renderStartScreen();
                     return;
                }
                renderSummary(answers, currentUserName, false);
            }
        }

        function handlePrev() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
            }
        }

        // Event Listeners
        nextBtn.addEventListener('click', handleNext);
        prevBtn.addEventListener('click', handlePrev);

        // Iniciar o Quiz na tela inicial
        renderStartScreen();
    </script>

</body>
</html>